<!DOCTYPE html>
<html>
<head>
  <title>Magic</title>
  <%= stylesheet_link_tag    "application" %>
  <%= javascript_include_tag "application" %>
  <%= csrf_meta_tags %>
</head>
<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="container">
        <a class="brand" href="/">Magic Q&A</a>
        <ul class="nav">
          <li id="questions-page" class="active"><a href="/">首页</a></li>
          <li id="profile-page"><a href="/users/<%= current_user.id %>">个人主页</a></li>
          <li id="create-question-page"><a href="/questions/new">提问</a></li>
        </ul>
        <ul class="nav secondary-nav">
          <li>
            <a href="/messages">私信<span id="nav-msg-new-num" style="display: none; "></span></a>   
          </li>
          <li id="messages-page">
            <a href="javascript:void(0)">通知<span id="nav-ntf-new-num" style="display: none; "></span></a>  
          </li>
          <li class="dropdown" data-dropdown="dropdown">
            <a href="#" class="dropdown-toggle"><%= current_user.name %></a>
            <ul class="dropdown-menu">
              <li><a href="/accounts">帐户流水</a></li>
              <li class="divider"></li>
              <li><a href="/users/sign_out">退出帐户</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="container">
    <div id="page-outer">
      <div id="page-container" class="row">
        <%= yield %>
      </div>
    </div>
  </div>
  <div style="z-index: 1000; ">
    <div id="msg_warpper" style="position: absolute;display:none;">
      <div id="msg_warpper_head">
        <a href="#">通知</a>
        <a class="msg_warpper_close" href="#">x</a>
      </div>
      <div id="msg_warpper_container">
        <div id="itemBox" class="itemBox" style="display:none;">
            <p>陈政宇 关注了你。</p>
            <span class="notification-time">2011-11-15 08:34:42</span>
        </div>
      </div>
      <div id="msg_warpper_footer">
        <a id="msg_warpper_close">关了我吧</a>
      </div>
    </div>
  </div>
</body>
</html>

<script type="text/javascript" charset="utf-8">
  //Messages Pusher
  var pusher = new Pusher('2f20b4687fdaada149b2');
  var message_channel = pusher.subscribe("presence-messages_<%= current_user.id %>");

  message_channel.bind('message_created', function(message) {
    count = 1;
    if($('#nav-msg-new-num').text().trim() != '')
      count = parseInt($('#nav-msg-new-num').text().trim()) + 1;
    $('#nav-msg-new-num').text(count).show();
  });
  $(function(){
    initNav();
    $("#messages-page a").bind('click',function(){
      msg_warpper_init()
    })
  });
  function msg_warpper_init(){
    $("#msg_warpper").slideDown()
    $("#msg_warpper_head .msg_warpper_close,#msg_warpper_close").bind("click",function(){
      $("#msg_warpper").slideUp()
    })
  }
</script>
